<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Length-Based Spawning Potential Ratio &bull; LBSPR</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">LBSPR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Length-Based Spawning Potential Ratio</h1>
                        <h4 class="author">Adrian Hordyk (<a href="mailto:a.hordyk@murdoch.edu.au">a.hordyk@murdoch.edu.au</a>)</h4>
            
            <h4 class="date">2016-10-31</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#introduction" class="anchor"> </a></body></html>Introduction</h1>
<p>This package contains functions to run the Length-Based Spawning Potential Ratio (LBSPR) method. The LBSPR package can be used in two ways: 1) simulation using the LBSPR model and 2) fitting to empirical length data to provide an estimate of the spawning potential ratio (SPR).</p>
<p>The LBSPR method has been developed for data-limited fisheries, where few data are available other than a representative sample of the size structure of the vulnerable portion of the population (i.e., the catch) and an understanding of the life history of the species. The LBSPR method does not require knowledge of the natural mortality rate (<em>M</em>), but instead uses the ratio of natural mortality and the von Bertalanffy growth coefficient (<em>K</em>) (<em>M</em>/<em>K</em>), which is believed to vary less across stocks and species than <em>M</em> (Prince et al. 2015).</p>
<p>Like any assessment method, the LBSPR model relies on a number of simplifying assumptions. In particular, the LBSPR models are equilibrium based, and assume that the length composition data is representative of the exploited population at steady state. See the publicaitons listed in the reference list for full details of the assumptions of the model, including simulation testing to evauate the effect of violations of these assumptions.</p>
<p><strong>Please make sure that you understand the assumptions of the model before using the LBSPR package on your data.</strong></p>
<p>There are two versions of the LBSPR model included in this package.</p>
<div id="age-structured-length-based-model" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#age-structured-length-based-model" class="anchor"> </a></body></html>Age-Structured Length-Based Model</h2>
<p>The LBSPR model described by Hordyk et al. (2015a, b), and tested in a MSE framework (Hordyk et al. 2015c), use a conventional age-structured equilibrium population model. An inherent assumption of this model structure is that selectivity is age-based not length-based.</p>
</div>
<div id="length-structured-growth-type-group-model" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#length-structured-growth-type-group-model" class="anchor"> </a></body></html>Length-Structured Growth-Type-Group Model</h2>
<p>Hordyk et al. (2016) describe a length-structured version of the LBSPR model that uses growth-type-groups (GTG) to account for size-based selectivity. The GTG-LBSPR model also has the ability to include variable <em>M</em> at size (by default <em>M</em> is assumed to be constant). The GTG-LBSPR model typically estimates a lower fishing mortality rate for a given size structure compared to the earlier age-structured model. This is because the age-structured model has a &lsquo;regeneration assumption&rsquo;, where, because of the age-based selectivity assumption, large individuals are expected even at high fishing mortality (large, young fish).</p>
<p>The default setting for the LBSPR package is to use the GTG-LBSPR model for all simulation and estimation. Control options in the simulation and estimation functions can be used to switch to the age-structured LBSPR model.</p>
</div>
<div id="bug-reports" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#bug-reports" class="anchor"> </a></body></html>Bug Reports</h2>
<p>The LBSPR package is still in development. It is possible, even highly likely, that there are bugs and issues with some of the functions. Please alert me to any bugs or issues by using (GitHub)[<a href="https://github.com/AdrianHordyk/LBSPR/issues" class="uri">https://github.com/AdrianHordyk/LBSPR/issues</a>].</p>
<p>Comments and suggestions for additional features are welcome. (GitHub pull requests)[<a href="https://github.com/AdrianHordyk/LBSPR/pulls" class="uri">https://github.com/AdrianHordyk/LBSPR/pulls</a>] with modifications or extensions are even more welcome!</p>
<p>Finally, please make sure you understand the data and the biological parameters (and how the model treats these) and critically evaluate any output of the LBSPR model. As they say:</p>
<blockquote>
<p>All Care Taken But We Accept No Responsibility</p>
</blockquote>
</div>
</div>
<div id="first-steps" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#first-steps" class="anchor"> </a></body></html>First Steps</h1>
<div id="installing-the-package" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#installing-the-package" class="anchor"> </a></body></html>Installing the Package</h2>
<p>The LBSPR package is not available on CRAN.</p>
<p>You can install the latest version of the package directly from GitHub using the <code>devtools</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># installed.packages("devtools")</span>
<span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">"AdrianHordyk/LBSPR"</span>)</code></pre></div>
</div>
<div id="load-the-package" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#load-the-package" class="anchor"> </a></body></html>Load the Package</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(LBSPR)</code></pre></div>
</div>
</div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#simulation" class="anchor"> </a></body></html>Simulation</h1>
<p>The LBSPR package can be used to generate the expected size composition, the SPR, and relative yield for a given set of biological and exploitation pattern parameters.</p>
<div id="lb_pars-object" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#lb_pars-object" class="anchor"> </a></body></html>LB_pars Object</h2>
<p>The first thing to do is to create a <code>LB_pars</code> object that contains all of the required parameters for the simulation model. <code>LB_pars</code> is an S4 class object.</p>
<p>The S4 system is different to the S3 system that is commonly used in R, and that R users are familiar with. Don&rsquo;t worry if you&rsquo;ve never used S4 objects before. The main thing to know is that elements in a S4 object are called <strong>slots</strong> and you access them using the <code>@</code> symbol (rather than the <code>$</code> symbol that is used with data.frames).</p>
<p>You can read more about S4 objects <a href="http://adv-r.had.co.nz/S4.html">here</a>.</p>
<!-- You can create an `LB_pars` object in two ways: 1) create an empty object in R and populate it manually, or read in a CSV containing the parameter values. -->
<div id="create-a-new-lb_pars-object" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#create-a-new-lb_pars-object" class="anchor"> </a></body></html>Create a new <code>LB_pars</code> Object</h3>
<p>To create a new <code>LB_pars</code> object you use the <code>new</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"LB_pars"</span>)</code></pre></div>
<pre><code>## A blank LB_pars object created</code></pre>
<pre><code>## Default values have been set for some parameters</code></pre>
<p>You can see the elements or <strong>slots</strong> of the <code>LB_pars</code> object using the <code>slotNames</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">slotNames</span>(MyPars)</code></pre></div>
<pre><code>##  [1] "Species"   "MK"        "Linf"      "CVLinf"    "L50"      
##  [6] "L95"       "Walpha"    "Wbeta"     "FecB"      "Steepness"
## [11] "Mpow"      "R0"        "SL50"      "SL95"      "FM"       
## [16] "SPR"       "BinMin"    "BinMax"    "BinWidth"</code></pre>
<p><code>MyPars</code> is an object of class <code>LB_pars</code>. You can access the help file for classes by using the <code>?</code> symbol (similar to how you find the help file for functions):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">class?CLASSNAME

class?LB_pars</code></pre></div>
</div>
<div id="populate-the-lb_pars-object" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#populate-the-lb_pars-object" class="anchor"> </a></body></html>Populate the <code>LB_pars</code> Object</h3>
<p>The <code>LB_pars</code> object has 19 slots. However, not all parameters need to be specified for the simulation model.</p>
<p>Some parameters are essential, and a warning message <strong>should</strong> appear if you attempt to progress without values (please let me know if there are issues).</p>
<p>Default values will be used for some of the other parameters if no value is specified. For example, the first slot (Species) is a character object that can be used for the species name. If this slot is left empty, the simulation model will populate it with a default value.</p>
<p>A message <strong>should</strong> alert you any time a default value is being used. Again, please let me know if you find something strange going on.</p>
<p>The minimum parameters that are needed for the simulation model are:</p>
<p><strong>Biology</strong></p>
<ul><li>von Bertalanffy asymptotic length (<code>Linf</code>)</li>
<li>M/K ratio (natural mortality divided by von Bertalanffy K coefficient) (<code>MK</code>)</li>
<li>Length at 50% maturity (<code>L50</code>)</li>
<li>Length at 95% maturity (<code>L95</code>)</li>
</ul><p><strong>Exploitation</strong> - Length at 50% selectivity (<code>SL50</code>) - Length at 95% selectivity (<code>SL95</code>) - F/M ratio (<code>FM</code>) <strong>or</strong> SPR (<code>SPR</code>). If you specify both, the F/M value will be ignored.</p>
<p><strong>Size Classes</strong> - Width of the length classes (<code>BinWidth</code>)</p>
<p>Remember, you can find the help documentation for the <code>LB_pars</code> object by typing: <code><a href="../reference/LB_pars-class.html">class?LB_pars</a></code> in the console.</p>
<p>To create an example parameter object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@Linf &lt;-<span class="st"> </span><span class="dv">100</span> 
MyPars@L50 &lt;-<span class="st"> </span><span class="dv">66</span> 
MyPars@L95 &lt;-<span class="st"> </span><span class="dv">70</span>
MyPars@MK &lt;-<span class="st"> </span><span class="fl">1.5</span> 

MyPars@SL50 &lt;-<span class="st"> </span><span class="dv">50</span> 
MyPars@SL95 &lt;-<span class="st"> </span><span class="dv">65</span>
MyPars@SPR &lt;-<span class="st"> </span><span class="fl">0.4</span>
MyPars@BinWidth &lt;-<span class="st"> </span><span class="dv">5</span></code></pre></div>
</div>
<div id="load-a-lb_pars-object-from-csv" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#load-a-lb_pars-object-from-csv" class="anchor"> </a></body></html>Load a <code>LB_pars</code> Object from CSV</h3>
<p>Still to come: read in parameter values for the <code>LB_pars</code> object directly from a CSV file.</p>
</div>
</div>
<div id="running-the-simulation-model" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#running-the-simulation-model" class="anchor"> </a></body></html>Running the Simulation Model</h2>
<p>Now we are ready to run the LBSPR simulation model. To do this we use the <code>LBSPRsim</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)</code></pre></div>
<pre><code>## No species name provided - using a default</code></pre>
<pre><code>## BinMax not set. Using default of 1.3 Linf</code></pre>
<pre><code>## BinMin not set. Using default value of 0</code></pre>
<p>You will notice some messages in the console alerting you that default values have been used. You can change these by specifying values in <code>MyPars</code> and re-running the <code>LBSPRsim</code> function.</p>
<p>We&rsquo;ll manually set those values here so we don&rsquo;t keep seeing the messages throughout the vignette.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@Species &lt;-<span class="st"> "MySpecies"</span>
MyPars@BinMax &lt;-<span class="st"> </span><span class="dv">150</span>
MyPars@BinMin &lt;-<span class="st"> </span><span class="dv">0</span></code></pre></div>
<div id="the-lb_obj-object" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#the-lb_obj-object" class="anchor"> </a></body></html>The <code>LB_obj</code> Object</h3>
<p>The output of the <code>LBSPRsim</code> function is an object of class <code>LB_obj</code>. This is another S4 object, and contains all of the information from the <code>LB_pars</code> object and the output of the <code>LBSPRsim</code> function.</p>
<p>Many of the functions in the LBSPR package return an object of class <code>LB_obj</code>. You should not modify the <code>LB_obj</code> object directly. Rather, make changes to the <code>LB_pars</code> object (<code>MyPars</code>) in this case, and re-run the simulation model (or other functions, covered later in the vignette).</p>
</div>
<div id="simulation-output" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#simulation-output" class="anchor"> </a></body></html>Simulation Output</h3>
<p>Let&rsquo;s take a look at some of the simulated output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MySim@SPR </code></pre></div>
<pre><code>## [1] 0.3999961</code></pre>
<p>Ignoring a small amount of rounding error, the simulated SPR is the same as our input value (<code>MyPars@SPR</code>).</p>
<p>What is the ratio of fishing mortality to natural mortality in this scenario?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MySim@FM </code></pre></div>
<pre><code>## [1] 0.6473832</code></pre>
<p>It is important to note that the F/M ratio reported in the LBSPR model refers to the <em>apical F</em> over the adult natural mortality rate. That is, the value for fishing mortality refers to the highest level of <em>F</em> experienced by any single size class.</p>
<p>If the selectivity pattern excludes all but the largest individuals from being exploited, it is possible to have a <strong>very</strong> high F/M ratio in a sustainable fishery (high SPR).</p>
<p>A couple of more simulations with alternative values:</p>
<p>Specify F/M instead of SPR:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@SPR &lt;-<span class="st"> </span><span class="kw">numeric</span>() <span class="co"># remove value for SPR </span>
MyPars@FM &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># set value for FM</span>
MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)
MySim@SPR <span class="co"># SPR at F/M = 1 </span></code></pre></div>
<pre><code>## [1] 0.2714598</code></pre>
<p>Change the life history parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@MK &lt;-<span class="st"> </span><span class="fl">2.0</span> 
MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)
MySim@SPR <span class="co"># SPR </span></code></pre></div>
<pre><code>## [1] 0.2435621</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@MK &lt;-<span class="st"> </span><span class="fl">0.5</span>
MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)
MySim@SPR <span class="co"># SPR </span></code></pre></div>
<pre><code>## [1] 0.3605154</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@Linf &lt;-<span class="st"> </span><span class="dv">120</span>
MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)
MySim@SPR <span class="co"># SPR </span></code></pre></div>
<pre><code>## [1] 0.3497405</code></pre>
<p>Change selectivity parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@MK &lt;-<span class="st"> </span><span class="fl">1.5</span> 
MyPars@SL50 &lt;-<span class="st"> </span><span class="dv">10</span>
MyPars@SL95 &lt;-<span class="st"> </span><span class="dv">15</span> 
MyPars@FM &lt;-<span class="st"> </span><span class="dv">1</span> 
MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)
MySim@SPR <span class="co"># SPR </span></code></pre></div>
<pre><code>## [1] 0.1345684</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@SL50 &lt;-<span class="st"> </span><span class="dv">80</span>
MyPars@SL95 &lt;-<span class="st"> </span><span class="dv">85</span> 
MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)
MySim@SPR <span class="co"># SPR </span></code></pre></div>
<pre><code>## [1] 0.5678794</code></pre>
</div>
<div id="control-options" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#control-options" class="anchor"> </a></body></html>Control Options</h3>
<p>There are a number of additional parameters that can be modified to control other aspects of the simulation model.</p>
<p>For example, by default the LBSPR model using the Growth-Type-Group model (Hordyk et at. 2016). The <code>Control</code> argument can be used to switch to the Age-Structured model (Hordyk et al. 2015a, b):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@Linf &lt;-<span class="st"> </span><span class="dv">100</span> 
MyPars@SL50 &lt;-<span class="st"> </span><span class="dv">50</span>
MyPars@SL95 &lt;-<span class="st"> </span><span class="dv">55</span> 
MyPars@FM &lt;-<span class="st"> </span><span class="kw">numeric</span>()
MyPars@SPR &lt;-<span class="st"> </span><span class="fl">0.4</span>
MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars, <span class="dt">Control=</span><span class="kw">list</span>(<span class="dt">modtype=</span><span class="st">"absel"</span>))
MySim@FM </code></pre></div>
<pre><code>## [1] 0.6683713</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MySim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars, <span class="dt">Control=</span><span class="kw">list</span>(<span class="dt">modtype=</span><span class="st">"GTG"</span>))
MySim@FM  <span class="co"># lower F/M for the GTG model</span></code></pre></div>
<pre><code>## [1] 0.6376642</code></pre>
<p>See the help file for the <code>LBSPRsim</code> function for additional parameters for the <code>Control</code> argument.</p>
</div>
<div id="plotting-the-simulation" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#plotting-the-simulation" class="anchor"> </a></body></html>Plotting the Simulation</h3>
<p>The <code>plotSim</code> function can be used to plot the expected equilibrium size composition generated by the LBSPR model.</p>
<p>Expected Unfished and Fished size structure of the catch:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotSim.html">plotSim</a></span>(MySim) </code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<p>Expected Unfished and Fished size structure of the population:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotSim.html">plotSim</a></span>(MySim, <span class="dt">type=</span><span class="st">"Pop"</span>)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<p>The maturity- and selectivity-at-length curves can also be plotted:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotMat.html">plotMat</a></span>(MySim)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-17-1.png" width="384"></p>
</div>
<div id="still-to-come" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#still-to-come" class="anchor"> </a></body></html>Still to Come</h3>
<ul><li>Plots of yield per recruit and relative yield (if <em>steepness</em> of stock-recruitment relationship is known)</li>
<li>Plots of von Bertlanffy growth curve, length-weight, etc</li>
<li>Functions to calculate SPR and Yield at F</li>
</ul><p>You can use a simple loop to produce a plot of SPR at different levels of <em>F/M</em> (or <em>F</em> if <em>M</em> is known). Below is an example for two different selectivity patterns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FMVec &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">3</span>, <span class="dt">by=</span><span class="fl">0.05</span>)
SPROut &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow=</span><span class="kw">length</span>(FMVec), <span class="dt">ncol=</span><span class="dv">2</span>)

MyPars@Linf &lt;-<span class="st"> </span><span class="dv">100</span> 
MyPars@MK &lt;-<span class="st"> </span><span class="fl">1.5</span> 
MyPars@L50 &lt;-<span class="st"> </span><span class="dv">50</span> 
MyPars@L95 &lt;-<span class="st"> </span><span class="dv">55</span>
MyPars@SPR &lt;-<span class="st"> </span><span class="kw">numeric</span>() <span class="co"># make sure SPR slot is empty</span>

MyPars@BinMin &lt;-<span class="st"> </span><span class="dv">0</span> 
MyPars@BinMax &lt;-<span class="st"> </span><span class="dv">130</span> 
MyPars@BinWidth &lt;-<span class="st"> </span><span class="dv">5</span>

for (ind in <span class="kw">seq_along</span>(FMVec)) {
  MyPars@SL50 &lt;-<span class="st"> </span><span class="dv">50</span>
  MyPars@SL95 &lt;-<span class="st"> </span><span class="dv">55</span>
  MyPars@FM &lt;-<span class="st"> </span>FMVec[ind]
  SPROut[ind, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)@SPR
  
  MyPars@SL50 &lt;-<span class="st"> </span><span class="dv">75</span>
  MyPars@SL95 &lt;-<span class="st"> </span><span class="dv">80</span>
  MyPars@FM &lt;-<span class="st"> </span>FMVec[ind]
  SPROut[ind, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRsim.html">LBSPRsim</a></span>(MyPars)@SPR
}

<span class="kw">plot</span>(<span class="kw">range</span>(FMVec), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">xlab=</span><span class="st">"F/M"</span>, <span class="dt">ylab=</span><span class="st">"SPR"</span>, <span class="dt">bty=</span><span class="st">"n"</span>, <span class="dt">type=</span><span class="st">"n"</span>)
<span class="kw">lines</span>(FMVec, SPROut[,<span class="dv">1</span>], <span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">lines</span>(FMVec, SPROut[,<span class="dv">2</span>], <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">legend</span>(<span class="st">"topright"</span>, <span class="dt">lty=</span><span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">title=</span><span class="st">"Selectivity"</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">"@Maturity"</span>, <span class="st">"Higher"</span>), <span class="dt">bty=</span><span class="st">"n"</span>)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
</div>
</div>
<div id="fitting-empirical-length-data" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#fitting-empirical-length-data" class="anchor"> </a></body></html>Fitting Empirical Length Data</h1>
<p>Two objects are required to fit the LBSPR model to length data: <code>LB_pars</code> which contains the life-history parameters (described above) and <code>LB_lengths</code>, which contains the length frequency data.</p>
<div id="creating-a-lb_lengths-object" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#creating-a-lb_lengths-object" class="anchor"> </a></body></html>Creating a <code>LB_lengths</code> object</h2>
<p>A <code>LB_lengths</code> object can be created in two ways. The <code>new</code> function can be used to create an empty object which can be manually populated:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyLengths &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"LB_lengths"</span>)</code></pre></div>
<pre><code>## File not found. A blank LB_lengths object created</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">slotNames</span>(MyLengths)</code></pre></div>
<pre><code>## [1] "LMids"  "LData"  "Years"  "NYears" "Elog"</code></pre>
<p>However, it is probably easier to create the <code>LB_lengths</code> object by directly reading in a CSV file.</p>
<p>A number of CSV files containing example data have been included in the LBSPR package. To find the location of the data files on your machine, use the <code>DataDir</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datdir &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DataDir.html">DataDir</a></span>()</code></pre></div>
<p>The available example files can be printed out using <code>list.files</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list.files</span>(datdir, <span class="dt">pattern=</span><span class="st">".csv"</span>)</code></pre></div>
<pre><code>## [1] "LFreq_MultiYr.csv"     "LFreq_MultiYrHead.csv" "LFreq_SingYr.csv"     
## [4] "LFreq_SingYrHead.csv"  "LRaw_MultiYr.csv"      "LRaw_MultiYrHead.csv" 
## [7] "LRaw_SingYr.csv"       "LRaw_SingYrHead.csv"</code></pre>
<p>The length data can be either <strong>raw</strong> data, that is, individual length measurements, or <strong>length frequency</strong> data, where the first column of the data set must contain the mid-points of the length bins, and the remaining columns contain the counts for each length class.</p>
<p>The data type (<code>freq</code> or <code>raw</code>) must be specified in the call to the <code>new</code> function.</p>
<p>A valid <code>LB_pars</code> object must also be supplied to the <code>new</code> function.</p>
<p>Following the normal convention in R, if a header row is present in the data file, the argument <code>header</code> in the call to <code>new</code> must be set to <code>TRUE</code>.</p>
<p>Finally, the full file path must be supplied to the <code>new</code> function in order to read in the CSV file. If the file is not found, or the <code>file</code> argument is left empty, a blank <code>LB_lengths</code> object with be created.</p>
</div>
<div id="reading-in-example-csv" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#reading-in-example-csv" class="anchor"> </a></body></html>Reading in Example CSV</h2>
<p>A valid <code>LB_pars</code> object must be first created (see sections above):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"LB_pars"</span>)</code></pre></div>
<pre><code>## A blank LB_pars object created</code></pre>
<pre><code>## Default values have been set for some parameters</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars@Species &lt;-<span class="st"> "MySpecies"</span>
MyPars@Linf &lt;-<span class="st"> </span><span class="dv">100</span> 
MyPars@L50 &lt;-<span class="st"> </span><span class="dv">66</span> 
MyPars@L95 &lt;-<span class="st"> </span><span class="dv">70</span>
MyPars@MK &lt;-<span class="st"> </span><span class="fl">1.5</span> </code></pre></div>
<p>Note that only the life history parameters need to be specified for the estimation model. The exploitation parameters will be estimated.</p>
<p>A length frequency data set with multiple years:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Len1 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"LB_lengths"</span>, <span class="dt">LB_pars=</span>MyPars, <span class="dt">file=</span><span class="kw">paste0</span>(datdir, <span class="st">"/LFreq_MultiYr.csv"</span>), <span class="dt">dataType=</span><span class="st">"freq"</span>)</code></pre></div>
<p>A length frequency data set with multiple years and a header row (identical to Len1 data, but with a header row):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Len2 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"LB_lengths"</span>, <span class="dt">LB_pars=</span>MyPars, <span class="dt">file=</span><span class="kw">paste0</span>(datdir, <span class="st">"/LFreq_MultiYrHead.csv"</span>), <span class="dt">dataType=</span><span class="st">"freq"</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>A raw length data set with multiple years:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Len3 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"LB_lengths"</span>, <span class="dt">LB_pars=</span>MyPars, <span class="dt">file=</span><span class="kw">paste0</span>(datdir, <span class="st">"/LRaw_MultiYr.csv"</span>), <span class="dt">dataType=</span><span class="st">"raw"</span>)</code></pre></div>
<pre><code>## Length bin parameters (BinMax) must be set for raw data. Using defaults</code></pre>
<pre><code>## Length bin parameters (BinMin) must be set for raw data. Using defaults</code></pre>
<pre><code>## Length bin parameters (BinWidth) must be set for raw data. Using defaults</code></pre>
<p>Notice that for raw length measurements you must specify the parameters for the length bins (maximum, minimum, and width of length classes) in the <code>LB_pars</code> object. If these are left blank, default values are used.</p>
</div>
<div id="plotting-length-data" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#plotting-length-data" class="anchor"> </a></body></html>Plotting Length Data</h2>
<p>The <code>plotSize</code> function can be used to plot the imported length data. This is usually a good idea to do before proceeding with fitting the model, to confirm that everything has been read in correctly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotSize.html">plotSize</a></span>(Len1)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotSize.html">plotSize</a></span>(Len2)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-27-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotSize.html">plotSize</a></span>(Len3)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-27-3.png" width="672"></p>
</div>
<div id="fit-the-model" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#fit-the-model" class="anchor"> </a></body></html>Fit the Model</h2>
<p>The LBSPR model is fitted using the <code>LBSPRfit</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myFit1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRfit.html">LBSPRfit</a></span>(MyPars, Len1)
myFit2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRfit.html">LBSPRfit</a></span>(MyPars, Len3)</code></pre></div>
<p>Note that the <code>Control</code> argument can be used to modify the additional parameters or LBSPR model type (see description in earlier section).</p>
</div>
<div id="examine-and-plot-results" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#examine-and-plot-results" class="anchor"> </a></body></html>Examine and Plot Results</h2>
<p>The LBSPR package uses a Kalman filter and the Rauch-Tung-Striebel smoother function (see <code>FilterSmooth</code>) to smooth out the multi-year estimates of SPR, F/M, and selectivity parameters.</p>
<p>The smoother parameter estimates can be accessed from the <code>myFit</code> object (which is an object of class <code>LB_obj</code> [see earlier section for details]):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myFit1@Ests</code></pre></div>
<pre><code>##          SL50     SL95        FM       SPR
## [1,] 48.48227 62.45054 0.5391273 0.4471170
## [2,] 48.49150 62.50824 0.5389455 0.4480386
## [3,] 48.48337 62.40175 0.5384740 0.4493289
## [4,] 48.49369 62.42311 0.5369927 0.4519306
## [5,] 48.43434 62.25561 0.5417449 0.4508460
## [6,] 48.22890 62.00275 0.5257542 0.4594711</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myFit2@Ests</code></pre></div>
<pre><code>##          SL50     SL95        FM       SPR
## [1,] 50.73096 66.64051 0.7032696 0.3977334
## [2,] 50.59793 66.39950 0.6970513 0.3993612
## [3,] 50.39604 66.21379 0.6843253 0.4033221
## [4,] 50.40019 66.51309 0.6844358 0.4031591
## [5,] 50.39663 66.58710 0.6799632 0.4050490
## [6,] 50.38433 66.38578 0.6709568 0.4089476</code></pre>
<p>Note that by default the smoothed estimates are used in the plotting routines.</p>
<p>The individual point estimates for each year can be accessed from the <code>LB_obj</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data.frame</span>(<span class="dt">rawSL50=</span>myFit1@SL50, <span class="dt">rawSL95=</span>myFit1@SL95, <span class="dt">rawFM=</span>myFit1@FM, <span class="dt">rawSPR=</span>myFit1@SPR)</code></pre></div>
<pre><code>##    rawSL50  rawSL95     rawFM    rawSPR
## 1 48.87476 62.49813 0.5463361 0.4423721
## 2 48.66520 64.15004 0.5418438 0.4443514
## 3 48.29876 61.12324 0.5485707 0.4362159
## 4 49.19038 64.31178 0.4746581 0.4887930
## 5 49.89528 63.10918 0.7491747 0.3537482
## 6 46.17451 59.47412 0.3658466 0.5457228</code></pre>
<p>The <code>plotSize</code> function can also be used to show the model fit to the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotSize.html">plotSize</a></span>(myFit1)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-32-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotSize.html">plotSize</a></span>(myFit2)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-32-2.png" width="672"></p>
<p>Similarly, the <code>plotMat</code> function can be used to show the specified maturity-at-length curve, and the estimated selectivity-at-length curve:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotMat.html">plotMat</a></span>(myFit1)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-33-1.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotMat.html">plotMat</a></span>(myFit2)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-33-2.png" width="480"></p>
<p>Finally, the <code>plotEsts</code> function can be used to visually display the estimated parameters. Note that this works for all data sets, but only makes sense when there are several years of data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotEsts.html">plotEsts</a></span>(myFit1)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-34-1.png" width="672"><img src="LBSPR_files/figure-html/unnamed-chunk-34-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotEsts.html">plotEsts</a></span>(myFit2)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-34-3.png" width="672"><img src="LBSPR_files/figure-html/unnamed-chunk-34-4.png" width="672"></p>
</div>
</div>
<div id="comparing-observed-length-data-to-target-size-structure" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#comparing-observed-length-data-to-target-size-structure" class="anchor"> </a></body></html>Comparing Observed Length Data to Target Size Structure</h1>
<p>You can compare the observed size data against an expected size composition at a target SPR using the <code>plotTarg</code> function. To do this, you need a <code>LB_pars</code> object with the life history parameters and the target SPR:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MyPars &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"LB_pars"</span>, <span class="dt">msg=</span><span class="ot">FALSE</span>)
MyPars@Linf &lt;-<span class="st"> </span><span class="dv">100</span> 
MyPars@L50 &lt;-<span class="st"> </span><span class="dv">66</span> 
MyPars@L95 &lt;-<span class="st"> </span><span class="dv">70</span>
MyPars@MK &lt;-<span class="st"> </span><span class="fl">1.5</span> 
MyPars@SPR &lt;-<span class="st"> </span><span class="fl">0.75</span> <span class="co"># Target SPR </span>
MyPars@BinWidth &lt;-<span class="st"> </span><span class="dv">5</span></code></pre></div>
<p>Here we have set the target SPR at 75%.</p>
<p>Then import your length data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LenDat &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"LB_lengths"</span>, <span class="dt">LB_pars=</span>MyPars, <span class="dt">file=</span><span class="kw">paste0</span>(datdir, <span class="st">"/LRaw_MultiYr.csv"</span>), <span class="dt">dataType=</span><span class="st">"raw"</span>, <span class="dt">msg=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>Finally, you must set the selectivity parameters for the simulated size data. You may be able to estimate these from the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Mod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/LBSPRfit.html">LBSPRfit</a></span>(MyPars, LenDat, <span class="dt">msg=</span><span class="ot">FALSE</span>)

yr &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># first year of data</span>
MyPars@SL50 &lt;-<span class="st"> </span>Mod@SL50[yr]
MyPars@SL95 &lt;-<span class="st"> </span>Mod@SL95[yr] 

<span class="kw"><a href="../reference/plotTarg.html">plotTarg</a></span>(MyPars, LenDat, <span class="dt">yr=</span>yr)</code></pre></div>
<p><img src="LBSPR_files/figure-html/unnamed-chunk-37-1.png" width="480"></p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#references" class="anchor"> </a></body></html>References</h1>
<p>Hordyk, A.R., Ono, K., Sainsbury, K.J., Loneragan, N., and Prince, J.D. 2015a. Some explorations of the life history ratios to describe length composition, spawning-per-recruit, and the spawning potential ratio. ICES J. Mar. Sci. 72: 204&acirc;&euro;&ldquo;216.</p>
<p>Hordyk, A.R., Ono, K., Valencia, S.R., Loneragan, N.R., and Prince, J.D. 2015b. A novel length-based empirical estimation method of spawning potential ratio (SPR), and tests of its performance, for small-scale, data-poor fisheries. ICES J. Mar. Sci. 72: 217&acirc;&euro;&ldquo;231.</p>
<p>Hordyk, A.R., Loneragan, N.R., and Prince, J.D. 2015c. An evaluation of an iterative harvest strategy for data-poor fisheries using the length-based spawning potential ratio assessment methodology. Fish. Res. 171: 20&acirc;&euro;&ldquo;32.</p>
<p>Hordyk, A., Ono, K., Prince, J.D., and Walters, C.J. 2016. A simple length-structured model based on life history ratios and incorporating size-dependent selectivity: application to spawning potential ratios for data-poor stocks. Can. J. Fish. Aquat. Sci. 13: 1&acirc;&euro;&ldquo;13. doi: 10.1139/cjfas-2015-0422.</p>
<p>Prince, J.D., Hordyk, A.R., Valencia, S.R., Loneragan, N.R., and Sainsbury, K.J. 2015. Revisiting the concept of Beverton&acirc;&euro;&ldquo;Holt life-history invariants with the aim of informing data-poor fisheries assessment. ICES J. Mar. Sci. 72: 194&acirc;&euro;&ldquo;203.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked"><li><a href="#age-structured-length-based-model">Age-Structured Length-Based Model</a></li>
      <li><a href="#length-structured-growth-type-group-model">Length-Structured Growth-Type-Group Model</a></li>
      <li><a href="#bug-reports">Bug Reports</a></li>
      </ul></li>
      <li><a href="#first-steps">First Steps</a><ul class="nav nav-pills nav-stacked"><li><a href="#installing-the-package">Installing the Package</a></li>
      <li><a href="#load-the-package">Load the Package</a></li>
      </ul></li>
      <li><a href="#simulation">Simulation</a><ul class="nav nav-pills nav-stacked"><li><a href="#lb_pars-object">LB_pars Object</a></li>
      <li><a href="#running-the-simulation-model">Running the Simulation Model</a></li>
      </ul></li>
      <li><a href="#fitting-empirical-length-data">Fitting Empirical Length Data</a><ul class="nav nav-pills nav-stacked"><li><a href="#creating-a-lb_lengths-object">Creating a <code>LB_lengths</code> object</a></li>
      <li><a href="#reading-in-example-csv">Reading in Example CSV</a></li>
      <li><a href="#plotting-length-data">Plotting Length Data</a></li>
      <li><a href="#fit-the-model">Fit the Model</a></li>
      <li><a href="#examine-and-plot-results">Examine and Plot Results</a></li>
      </ul></li>
      <li><a href="#comparing-observed-length-data-to-target-size-structure">Comparing Observed Length Data to Target Size Structure</a></li>
      <li><a href="#references">References</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adrian Hordyk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
